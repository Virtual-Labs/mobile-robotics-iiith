<!-- This file needs to be edited by the lab developer to suit
the requirements of their lab in particular.-->

<!-- Add class="default" to include any element as it is
specified in default.html. 
Do not include class="default" to the elements that you want to
edit -->

<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>

<div id="experiment"> <!-- The Experiment Document Container-->

  <!-- The lab Header contains the logo and the name of the lab,
  usually displayed on the top of the page-->

  <header id="experiment-header" class="default">
  
    <div id="experiment-header-logo" class="logo">
      <!-- Enclose the logo image of your lab or write it in 
      text-->
      <img src="../images/logo.jpg" />
    </div>

    <div id="experiment-header-heading" class="heading">
      <!-- Write the name of your lab and link it to the home 
      page of your lab (h1 tag is preferred while writing your 
      lab name)-->
      <a href="../index.html">Mobile Robotics</a>	
    </div>

    <!-- Add any additional element you want to add to the lab 
    header, For example : Help (Enclosing them with suitable 
    div is recommended)-->

  </header>


  <!-- The lab article is the main content area where all the 
  experiment content sits-->
  <article id="experiment-article">
  
    <!-- The lab article has an header, optional navigational 
    menu, number of sections, an optional sidebar and a closing 
    footer-->
     <div id="experiment-article-breadcrumb" class="breadcrumb">
     </div>
    
      <header id="experiment-article-heading" class="heading">
        <!-- You can add a welcome message or title of the 
        experiment here -->
        Velocity Modelling
        <!-- Add any additional element if required with proper 
        enclosing-->
      </header>

      <!-- Navigation menu is useful to organize the view of 
      multiple sections inside the article-->
      <nav id="experiment-article-navigation" class="default">
        <ul id="experiment-article-navigation-menu">
          <!-- The menu can be dynamically generated to contain 
          the headings of your sections or instead write the 
          menu items of your choice individually enclosedu in 
          <li> tag as shown below-->
        </ul>
      </nav>

      <!-- All the sections of your lab or experiment can be 
      enclosed together with a div element as shown below-->
      <div id="experiment-article-sections">

        <!-- First section of the article-->
        <section id="experiment-article-section-1">
          
          <div id="experiment-article-section-1-icon" 
          class="icon">
	    <!-- Enclose the icon image of your lab -->
	    <img src="../images/introduction.jpg" />
	  </div>	
          
          <!-- The heading for the section can be enclosed in a 
          div tag. -->
          <div id="experiment-article-section-1-heading" 
          class="heading">
            Introduction
          </div>

          <!-- Write the section content inside a paragraph 
          element, You can also include images with <img> tag -->
          <div id="experiment-article-section-1-content" 
          class="content">	
		<p> <b>Why do we need Models?</b></p>
<p>
	A Robot's motion is inherently inaccurate/noisy. If we give it a command to go forward by 10 metres, it may end up reaching short of the goal or overshooting it. 
	This may be due to wheel slippage because of a lack of traction or many other reasons.
</p>

<p>	It is very often important that we have an accurate estimate of the robot's position. Doing so aids in map-building and prevents collision.  </p>

<p> In order to have an accurate estimate of the robot's position, we need to be able to accurately predict how far it how it has moved. <b>Enter Velocity Models.</b>
</p>

<p> Velocity Models are used to model the noise inherent in a robot's motion. </p>

<p>A probability distribution function is used to model the uncertainty of the robots pose. The higher the value of the pdf at a particular pose  in the distribution the larger the likelier it is that the robot is present there.</p>

<p> We usually use a Gaussian pdf to model the robot's pose.  The mean of the Gaussian representing the intended position that the robot would have reached under ideal conditions. The farther we move away from the mean the less likely it is that the robot is at that particular position. A Gaussian with a low standard deviation indicates that it is very likely that the robot is in close proximity to the mean. A Gaussian with a high standard deviation indicates the robot may be relatively far from the mean (but never too far, as the Gaussian falls to almost zero at positions far away from the robot). </p>

<br>

        </div>


      </section>

      <!-- Second section of the article-->
      <section id="experiment-article-section-2">
        
        <div id="experiment-article-section-2-icon" 
        class="icon">
	  <!-- Enclose the icon image of your lab. -->
	  <img src="../images/theory.jpg" />
	</div>
				
        <!-- The heading for the section can be enclosed in a 
        div tag. -->
        <div id="experiment-article-section-2-heading" 
        class="heading">
          Theory
        </div>


        <!-- Write the section content inside a paragraph 
        element, we can also include images with <img> tag -->
        <div id="experiment-article-section-2-content" 
        class="content">
<br>
	<p> In our model we assume that the Robot initially executes the rotation and then the transaltion.</p>	
	<br>
	<center><img src="./images/1.jpg" style="height:400px; width:400px;"></center>
	<br>
	<br>
	<p> Let it's rotational velocity be given by the variable ω. Let it's transloational velocity be given by the variable V. We add a Gaussian noise N(0,σ<sub>v</sub>). Where σ<sub>v</sub> is the standard deviation int the velocity. Similarly to  ω we add N(0,σ<sub>ω</sub>). </p>
	<p> The resulting set of equations are:</p>
	<ol style="padding:30px;">
		<li><b>V' = V + N(0,σ<sub>v</sub>)</b></li>
		<li><b>ω' =  ω + N(0,σ<sub>ω</sub>)</b></li>
	</ol>
	<p>
	Thus the noise free or predicted (predicted in the sense that without any information on the noise we would predict the robot's pose from the equations given below) position of the robot is given by the equations:</p>
	<ol style="padding:30px;">
		<li><b>X' = X + V x dT x cos(θ + ω x dT)</b></li>
		<li><b>Y' = Y + V x dT x sin(θ + ω x dT)</b></li>
		<li><b>θ' = θ + ω x dT</b></li>
	</ol>
	<br>
	<p>On the other hand the actual equations (with noise) are given by: </p>
	<ol style="padding:30px;">
	<li><b>X<sub>n</sub>' = X<sub>n</sub> + V' x dT x cos(θ<sub>n</sub>+ω' x dT)</b></li>
	<li><b>Y<sub>n</sub>' = Y<sub>n</sub> + V x dT x sin(θ<sub>n</sub>+ω' x dT)</b></li>
	<li><b>θ<sub>n</sub>' = θ<sub>n</sub> + ω' x dT</b></li>
	</ol>
	<p> Here dT- represents the time unit</p>
	
	<p> <b>(X,Y,θ)</b> the initial pose of the robot(noise free).</p>
	<p> <b>(X<sub>n</sub>,Y<sub>n</sub>,θ<sub>n</sub>)</b>
	 the initial pose of the robot(with noise).</p>	
	<p> <b>V</b>, <b>V'</b>  the noise free and noisy translational velocities.</p>
	<p> <b>ω</b>, <b>ω'</b>  the noise free and noisy translational velocities.</p>	
	
	<br>
	<br>	
	<center><img src="./images/scream.jpg" style="height:400px; width:400px;"></center>
	<br>
	<br>
	   
	   <p>Now, as a robot moves due to its noisy motion the uncertainity in its pose increases. This means, its Standard Deviation and thus Variance increases. Thus Σ<sub>t</sub> increases.</p>
	   
	   
	   <center><img src="images/vModel22.jpg" style="height:400px; width:400px;"></center>
	   
	   
	   <p>We use the prediction phase of the <b>Extended Kalman Filter</b> to model the increase in covariance. The following equation is used:</p>
	   <p><b> Σ<sub>t</sub>=G x Σ<sub>t-1</sub>  x G<sup>T</sup> + J<sub>t</sub> x Q x J<sup>T</sup></b></p>
		

		<p>The Covariance of the Robot's Pose at time <b>t</b> is given by <b>Σ<sub>t</sub></b>.</p>
		<p>The Covariance of the Velocity Model's noise is given by <b>Q</b>.</p>
		<p>Here G is the Jacobian of the new robot Pose <b>(X',Y',θ')</b> wrt. it's old state <b>(X,Y,θ)</b>.</p>
	   <p>Here J is the Jacobian of the new robot Pose <b>(X',Y',θ')</b> wrt. it's velocity vector <b>(V,ω)</b>.</p>

		<p> The expression for <b>Q</b> is given by the 2 by 2 matrix:</p>
	
		<p><b>| σ<sub>v</sub><sup>2</sup>&nbsp;&nbsp; 0&nbsp; |<br>
		   |   0	&nbsp;	σ<sub>ω</sub><sup>2</sup> |</b></p>
	   
	   <p>From the expression one can gather that there is no correlation between V and ω.</p>
	   <p> As you can see in the equation from time <b>t-1</b> to time <b>t</b> there is an increase in the state's uncertainity. </p>

		<br>

	   <h3> Note on Jacobians</h3>
	   <p><b>Definition:</b>In vector calculus, the Jacobian matrix  is the matrix of all first-order partial derivatives of a vector- or scalar-valued function with respect to another vector.</p>
	   <p>The Jacobian is used when making a change of variables when evaluating a multiple integral of a function over a region within its domain.</p>
<p>	   <b>How is the Jacobian relevant in the robot's context?</b></p>
	   <p>In our model, we assume that the robot intially does a rotation then a translation. It does not carry out both operations simultaneously. Therefore, it is reasonable to assume that the error in rotation and the error in translation are independent. This is also represented in our <b>Q</b> (velocity model covariance) matrix. V and ω are independent of each other. This type of a model is often seen in differential drive robots. </p>
	   <p> Now, in order to add the noise in <b>(V,ω)</b> to <b>(X,Y,θ)</b> we have to have a change of variables. Here, comes in the Jacobian. <b>J</b>, as mentioned above is the Jacobian of the new state <b>(X',Y',θ')</b> with respect to it's old state <b>(V,ω)</b>. Thus, transferring noise in <b>(V,ω)</b> to <b>(X',Y',θ')</b> through their covariance matrices. </p>
	   <p> Transferring the noise from the previous state (<b>Σ<sub>t-1</sub></b>) to the current state (<b>Σ<sub>t</sub></b>) follows the same logic. This time the Jacobian is of the new state <b>(X',Y',θ')</b> with respect to the old state <b>(X,Y,θ)</b>.</p>
	   <br>
		
		<h3>How the covariance matrix represents the uncertainity ellipse</h3>
		<p>A covariance matrix  is a matrix whose element in the <b>i</b>, <b>j</b> position is the covariance between the <b>i<sup>th</sup></b> and <b>j<sup>th</sup></b> elements of a vector. </p>

	   <p> In the experiment you can see that an ellipse representing the covariance in X & Y increases as a robot continues moving.</p>
	   <p> The ideal path or predicted of the robot is given by the black circle with its attached line giving it's direction. The red dot represents the noisy or actual path of the robot. As the robot moves the ellipse increases in size showing that the uncertainity in the robot's position is increasing. The covariance matrix generalizes the notion of variance to multiple dimensions. </p>
	   
	   <p> In our case, the covariance matrix is a 3 x 3 matrix representing the correlations between X, Y and θ. In order to plot the uncertainity ellipse, we use the 2 x 2 sub-matrix representing the correlations between X and Y. </p>
	  <p> This sub-matrix is decomposed into its respective eigen-vectors and eigen-values. The larger eigen vector (the one that has a larger norm) gives the direction of the major axis of the ellipse in the X-Y plane. Similarly, the smaller eigen-vector give the direction of minor axis. The lengths of the major and minor axis are given by the eigen values. Again, the length of the major axis is directly proportional to the larger eigen value. Likewise, for the minor axis we use the smaller eigen value. </p>

		
        </div>
      </section>


      <section id="experiment-article-section-3">
        
        <div id="experiment-article-section-3-icon" 
        class="icon">
	  <!-- Enclose the icon image of your lab. -->
	  <img src="../images/objective.jpg" />
	</div>
     
        <div id="experiment-article-section-3-heading" 
        class="heading">
          Objective
        </div>

        <div id="experiment-article-section-3-content" class="content">
<p>The objective of this virtual lab is to show how noise can affect a robot's motion, trajectory and certainity of pose. Different parameters can be adjusted and its effect observed in the simulation. </p>
        </div>
      </section>
      
      

        <section id="experiment-article-section-7">
	  
          <div id="experiment-article-section-7-icon" 
          class="icon">
	    <!-- Enclose the icon image of your lab. -->
	    <img src="../images/procedure.jpg" />
	  </div>
	
          <div id="experiment-article-section-7-heading" 
          class="heading">
	    Procedure
	  </div>
	
      <div id="experiment-article-section-7-content" class="content" style="padding:30px;">
	  <p><b>Information to use the Experiment:</b> </p>

 <p><b>1.</b> Select the desired parameters.</p>
 <p> When entering a value please don't forget to press enter so that the value is registered. This will result in a visible outcome in case of parameters X,Y,Heading. (The robot will either move in the applet or rotate.) Also, entering an invalid value that is out of the display area of the applet will result in a resetting of the robot position to the centre of the screen. </p>
 <p><b>2.</b> Select the standard deviations in the velocity models sigmaV and sigmaOmega.</p>
 <p><b>3.</b> Press Start</p>
 <p>Pressing start causes the robot to return to it's default position at the centre of the applet.</p>	
 <p><b>4.</b> Press Reset to Reinitialize</p>
 <p><b>5.</b> Try out some new parameters</p>
 
 <p><b>Units</b></p>
 <ul style="padding:30px;">
 <li>The linear velocity is in metres/second. </li>
<li> The angular velocity is in radians/second.</li>
 </ul>
 
 <p><b>Note:</b><br>
 <p>In the experiment:</p>
 
 <p>
 The blue ellipse represents is a visual representation of the uncertainity of the position of the robot. The larger the ellipse the more uncertain the position of the robot. The red dot represents an estimate of the robot's position as sampled from the velocity model. The black circle (with a black line indicating the heading) is 
 the position of the robot were there no noise. 
 </p>

	  </div>
	
        </section>
			      
      
      
      
      
      
      
      
      
      
      


      <section id="experiment-article-section-4">

        <div id="experiment-article-section-4-icon" 
        class="icon">
	  <!-- Enclose the icon image of your lab.-->
	  <img src="../images/simulation.jpg" />
	</div>

        <div id="experiment-article-section-4-heading" 
        class="heading">
          Experiment
        </div>

        <div id="experiment-article-section-4-content" 
        class="content">
          <p><center>
  <applet code="initMain2.class" archive="VelocityModels.jar,lib/Jama-1.0.2.jar" height="620" width="1000"></applet>
            </center>
          </p>
        </div>

      </section>

<!--      <section id="experiment-article-section-5">
   
        <div id="experiment-article-section-5-icon" 
        class="icon">

	  <img src="../images/manual.jpg" />
	</div>

        <div id="experiment-article-section-5-heading" 
        class="heading">
          Manual
        </div>

        <div id="experiment-article-section-5-content" 
        class="content">
			<p>Nothing Here.</p>
          </div>

        </section>-->

        <section id="experiment-article-section-6">
      
          <div id="experiment-article-section-6-icon" 
          class="icon">
	    <!-- Enclose the icon image of your lab.-->
	    <img src="../images/quizzes.jpg" />
	  </div>

          <div id="experiment-article-section-6-heading" 
          class="heading">
            Quizzes
          </div>

          <div id="experiment-article-section-6-content" 
          class="content">
			<ol style="padding:30px;">
			<li>Does the initial position of the robot affect the result of the experiment?</li><br>
			<li>Since time is a parameter in the experiment and also a variable in the equations, why don't we add noise?</li><br>
			<li>Ultimately, we are trying to predict the pose of the robot, so why do we add noise to the velocity and not the pose?</li><br>
			<li>What percentage of the time should the estimate(red dot) be in the ellipse?</li><br>
			<li>If the estimate(red dot) leaves the ellipse will it tend to come back into the ellipse or go farther away? how do you interpret this?</li><br>
			</ol>            
		
          </div>

        </section>


		
        <section id="experiment-article-section-8">
   
          <div id="experiment-article-section-8-icon" 
          class="icon">
	    <!-- Enclose the icon image of your lab.-->
	    <img src="../images/readings.jpg" />
	  </div>

          <div id="experiment-article-section-8-heading" 
          class="heading">
            Further Readings
          </div>

          <div id="experiment-article-section-8-content" 
          class="content"  >
            <ul style="padding:30px;">	
              <li>
			  <b>Probabilistic Robotics</b> by&nbsp; Thrun Burgard Fox.
              </li>
              <li>
				<b> Introduction to Autonomous Mobile Robots</b> by Rolan Siegwart and Illah R. Nourbakhsh.
              </li> 
              <li>
			  <b> Computational Principles of Mobile Robotics</b> by Gregory Dudek and Michael Jenkin.
              </li>
            </ul>
          </div>
        </section>
      </div>


    <!-- An article can have a sidebar that contain related 
    links and additional material (however it is kept optional 
    at this moment) -->
    <aside id="lab-article-sidebar" class="default">
      <!-- put the content that you want to appear in the 
      sidebar -->	
    </aside>


    <!-- Article footer can display related content and 
    additional links -->						
    <footer id="lab-article-footer" class="default">
      <!-- Put the content that you want to appear here -->
    </footer>

  </article>


  <!-- Links to other labs, about us page can be kept the lab 
  footer-->
<footer id="lab-footer" style="color:white">
<p><center>Feedback: <a href="http://virtual-labs.ac.in/feedback/">http://virtual-labs.ac.in/feedback/</a></center></p>
<p><center>Sponsored by MHRD: <a href="http://virtual-labs.ac.in/nmeict/" >http://virtual-labs.ac.in/nmeict/</a></center></p>
<p><center>Licensing Terms: <a href="http://virtual-labs.ac.in/licensing/" >http://virtual-labs.ac.in/licensing/</a></center></p>
</footer>

</div>		

</body>
</html>
